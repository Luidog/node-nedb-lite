(function(){"use strict";var e;(function(){e=function(t,n){if(!t||!t.name||typeof t.name!="string")throw new Error('Nedb - missing name param, e.g. new Nedb({ name: "table1" })');this.name=t.name,e.dbTableDrop(this,e.nop),e.dbTableDict[this.name]=this,this.
persistence=new e.Persistence({db:this}),this.executor=new e.Executor,this.indexes={_id:new e.Index({fieldName:"_id",unique:!0}),createdAt:new e.Index({fieldName:"createdAt"}),updatedAt:new e.Index({fieldName:"updatedAt"})},this.ttlIndexes={},this.load(t,n)
},e.Nedb=e.local=e,e.modeJs=function(){try{return typeof navigator.userAgent=="string"&&typeof document.querySelector("body")=="object"&&typeof XMLHttpRequest.prototype.open=="function"&&"browser"}catch(e){return module.exports&&typeof process.versions.node=="string"&&typeof 
require("http").createServer=="function"&&"node"}}(),e.global=e.modeJs==="browser"?window:global})(),function(){e.assert=function(e,t){var n;if(e)return;throw n=t&&t.message?t:new Error(typeof t=="string"?t:JSON.stringify(t)),n},e.dbExport=function(){var t;
return t="",Object.keys(e.dbTableDict).map(function(n){t+=e.dbTableDict[n].export()+"\n\n"}),t.slice(0,-2)},e.dbImport=function(t,n){var r;r=function(){r.counter-=1,r.counter===0&&n()},r.counter=0,r.counter+=1,t.trim().split("\n\n").forEach(function(t){r.counter+=1
,e.dbTableCreate({persistenceData:t,name:JSON.parse(/.*/.exec(t)[0])},r)}),r()},e.dbReset=function(t){var n;n=function(){n.counter-=1,n.counter===0&&t()},n.counter=0,n.counter+=1,Object.keys(e.dbTableDict).forEach(function(t){n.counter+=1,e.dbTableDrop({name
:t},n)}),n.counter+=1,e.storeClear(n),n()},e.dbTableCreate=function(t,n){var r;return r=e.dbTableDict[t.name],r?(setTimeout(function(){r.load(t,n)}),r):new e.Nedb(t,n)},e.dbTableDict={},e.dbTableDrop=function(t,n){var r;r=e.dbTableDict[t.name];if(!r){n();return}delete 
e.dbTableDict[t.name],r.persistence=r.prototype=r,r.persistCachedDatabase=r.persistNewState=function(){var e;for(e=-1;e<arguments.length;e+=1)if(typeof arguments[e]=="function"){arguments[e]();return}},e.storeRemoveItem(r.name,n)},e.fsDir=function(){return e
.fsDirInitialized?e.fsDirInitialized:(e.fsDirInitialized="tmp/nedb.persistence."+e.NODE_ENV,e.child_process.spawnSync("mkdir",["-p",e.fsDirInitialized],{stdio:["ignore",1,2]}),e.fsDirInitialized)},e.jsonStringifyOrdered=function(e,t,n){var r,i,s;return i=function(
e){if(e&&typeof e=="object"&&typeof e.toJSON!="function"){if(r.indexOf(e)>=0)return;return r.push(e),Array.isArray(e)?"["+e.map(function(e){return s=i(e),typeof s=="string"?s:"null"}).join(",")+"]":"{"+Object.keys(e).sort().map(function(t){return s=i(e[t]),typeof 
s=="string"?JSON.stringify(t)+":"+s:undefined}).filter(function(e){return typeof e=="string"}).join(",")+"}"}return JSON.stringify(e)},r=[],JSON.stringify(e&&typeof e=="object"?JSON.parse(i(e)):e,t,n)},e.nop=function(){return},e.prototype.export=function(){
var t,n;return n=this,t="",t+=JSON.stringify(String(this.name))+"\n",n.getAllData().forEach(function(n){t+=e.model.serialize(n)+"\n"}),Object.keys(n.indexes).forEach(function(r){if(r==="_id")return;t+=e.model.serialize({$$indexCreated:{fieldName:r,unique:n.
indexes[r].unique,sparse:n.indexes[r].sparse}})+"\n"}),t.slice(0,-1)},e.prototype.load=function(t,n){var r,i,s,o;return o=this,i=0,s=function(u){i=u?Infinity:i+1;switch(i){case 1:n=n||function(t){e.assert(!t,t)},r=(t.persistenceData||"").trim(),t.reset&&(r="undefined"
);if(!r){s();return}o.isLoaded=null,r+="\n",r=r.slice(r.indexOf("\n")+1),e.storeSetItem(o.name,r,s);break;case 2:if(o.isLoaded){s();return}o.isLoaded=!0,o.loadDatabase(s);break;default:n(u,o)}},s(t.error),o},e.sortCompare=function(e,t){var n,r;if(e===t)return 0
;if(e===undefined)return-1;if(t===undefined)return 1;if(e===null)return-1;if(t===null)return 1;n=typeof e,r=typeof t;if(n!==r){if(n==="boolean")return-1;if(r==="boolean")return 1;if(n==="number")return-1;if(r==="number")return 1;if(n==="string")return-1;if(
r==="string")return 1}return e<t?-1:e>t?1:0},e.storeAction=function(t,n){var r,i,s,o,u,a;if(!e.store){r=arguments,e.storePromiseList.push(function(){e.storeAction.apply(null,r)});return}o=function(){if(s)return;s=!0,n(u&&(u.error||u.transaction.error),i||u.
result)};switch(t.action){case"clear":case"removeItem":case"setItem":a=e.store.transaction("nedbdata","readwrite").objectStore("nedbdata");break;default:a=e.store.transaction("nedbdata","readonly").objectStore("nedbdata")}switch(t.action){case"clear":u=a.clear
();break;case"getItem":u=a.get(t.key);break;case"keys":i=[],u=a.openCursor(),u.onsuccess=function(){if(!u.result){o();return}i.push(u.result.key),u.result.continue()};break;case"length":u=a.count();break;case"removeItem":u=a.delete(t.key);break;case"setItem"
:u=a.put(t.value,t.key)}["onabort","onerror","onsuccess"].forEach(function(e){u[e]=u[e]||o})},e.storeClear=function(t){e.storeAction({action:"clear"},t)},e.storeGetItem=function(t,n){e.assert(typeof t=="string"),e.storeAction({action:"getItem",key:t},n)},e.
storeInit=function(){var t,n,r;if(!e.global.indexedDB)return;t=0,n=function(i){e.store=e.global.nedbStore,e.assert(e.store||!i,i),t+=1;switch(t){case 1:if(e.store){n();return}r=e.global.indexedDB.open("NeDB"),r.onerror=function(){n(r.error)},r.onsuccess=function(
){e.global.nedbStore=r.result,n()},r.onupgradeneeded=function(){r.result.objectStoreNames.contains("nedbdata")||r.result.createObjectStore("nedbdata")};break;case 2:while(e.storePromiseList.length)e.storePromiseList.shift()()}},n()},e.storeKeys=function(t){
e.storeAction({action:"keys"},t)},e.storeLength=function(t){e.storeAction({action:"length"},t)},e.storePromiseList=[],e.storeRemoveItem=function(t,n){e.assert(typeof t=="string"),e.storeAction({action:"removeItem",key:t},n)},e.storeSetItem=function(t,n,r){e
.assert(typeof t=="string"),e.assert(typeof n=="string"),e.storeAction({action:"setItem",key:t,value:n},r)},e.asyncEachSeries=function(t,n,r){var i,s;if(!t.length)return r();i=0,s=function(){n(t[i],function(n){n?(r(n),r=e.nop):(i+=1,i>=t.length?r():s())})},
s()},e.asyncQueue=function(e){function n(e){var t=!1;return function(){if(t)throw new Error("Callback was already called.");t=!0,e.apply(null,arguments)}}var t;return t={tasks:[],push:function(e,n){e.constructor!==Array&&(e=[e]),e.forEach(function(e){var r=
{data:e,callback:typeof n=="function"?n:null};t.tasks.push(r)}),setTimeout(t.process)},process:function(){var r;!t.isRunningTask&&t.tasks.length&&(r=t.tasks.shift(),t.isRunningTask=!0,e(r.data,n(function(){t.isRunningTask=null,r.callback&&r.callback.apply(r
,arguments),t.process()})))}},t},e.inherits=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})},e.isDate=function(e){return Object.prototype.toString.call(e)==="[object Date]"},e
.isRegExp=function(e){return Object.prototype.toString.call(e)==="[object RegExp]"},e.listUnique=function(e){var t;return t={},e.filter(function(e){if(t.hasOwnProperty(e))return;return t[e]=!0,!0})}}();switch(e.modeJs){case"node":e.storeClear=function(t){e.
child_process.spawn("sh",["-c","rm "+e.fsDir()+"/*"],{stdio:["ignore",1,2]}).once("exit",t)},e.storeGetItem=function(t,n){e.assert(typeof t=="string"),e.fs.readFile(e.fsDir()+"/"+encodeURIComponent(t),"utf8",function(t,r){e.nop(t),n(null,r||"")})},e.storeKeys=
function(t){e.fs.readdir(e.fsDir(),function(e,n){t(e,n&&n.map(decodeURIComponent))})},e.storeLength=function(t){e.fs.readdir(e.fsDir(),function(e,n){t(e,n&&n.length)})},e.storeRemoveItem=function(t,n){e.assert(typeof t=="string"),e.fs.unlink(e.fsDir()+"/"+encodeURIComponent
(t),function(t){e.nop(t),n()})},e.storeSetItem=function(t,n,r){var i;e.assert(typeof t=="string"),e.assert(typeof n=="string"),i=e.os.tmpdir()+"/"+Date.now()+Math.random(),e.fs.writeFile(i,n,function(n){e.nop(n),e.fs.rename(i,e.fsDir()+"/"+encodeURIComponent
(t),r)})}}(function(t){if("function"==typeof bootstrap)bootstrap("nedb",t);else if("object"==typeof exports)module.exports=t();else if("function"==typeof define&&define.amd)define(t);else if("undefined"!=typeof ses){if(!ses.ok())return;ses.makeNedb=t}else"undefined"!=typeof 
e.global?e.global.Nedb=t():global.Nedb=t()})(function(){var t,n,r,i,s;return function(t,n,r){function i(r,o){if(!n[r]){if(!t[r]){var u=typeof require=="function"&&require;if(!o&&u)return u(r,!0);if(s)return s(r,!0);throw new Error("Cannot find module '"+r+"'"
)}var a=n[r]={exports:{}};t[r][0].call(a.exports,function(n){var s=t[r][1][n];return e[n]=i(s?s:n)},a,a.exports)}return n[r].exports}var s=typeof require=="function"&&require;for(var o=0;o<r.length;o++)i(r[o]);return i}({5:[function(t,n,r){function s(e,t,n)
{this.db=e,this.query=t||{},n&&(this.execFn=n)}var i=t("./model");s.prototype.limit=function(e){return this._limit=e,this},s.prototype.skip=function(e){return this._skip=e,this},s.prototype.sort=function(e){return this._sort=e,this},s.prototype.projection=function(
e){return this._projection=e,this},s.prototype.project=function(e){var t=[],n=this,r,s,o;return n._projection===undefined||Object.keys(n._projection).length===0?e:(r=n._projection._id===0?!1:!0,o=Object.keys(n._projection).filter(function(e){return e!=="_id"
}),o.forEach(function(e){if(s!==undefined&&n._projection[e]!==s)throw new Error("Can't both keep and omit fields except for _id");s=n._projection[e]}),e.forEach(function(e){var n;s===1?(n={$set:{}},o.forEach(function(t){n.$set[t]=i.getDotValue(e,t),n.$set[t
]===undefined&&delete n.$set[t]}),n=i.modify({},n)):(n={$unset:{}},o.forEach(function(e){n.$unset[e]=!0}),n=i.modify(e,n)),r?n._id=e._id:delete n._id,t.push(n)}),t)},s.prototype._exec=function(t){function c(e,n){return o.execFn?o.execFn(e,n,t):t(e,n)}var n=
[],r=0,s=0,o=this,u=null,a,f,l;this.db.getCandidates(this.query,function(t,u){if(t)return c(t);try{for(a=0;a<u.length;a+=1)if(i.match(u[a],o.query))if(!o._sort)if(o._skip&&o._skip>s)s+=1;else{n.push(u[a]),r+=1;if(o._limit&&o._limit<=r)break}else n.push(u[a]
)}catch(t){return c(t)}if(o._sort){f=Object.keys(o._sort);var h=[];for(a=0;a<f.length;a++)l=f[a],h.push({key:l,direction:o._sort[l]});n.sort(function(t,n){var r,s,o;for(o=0;o<h.length;o++){r=h[o],s=r.direction*e.sortCompare(i.getDotValue(t,r.key),i.getDotValue
(n,r.key));if(s!==0)return s}return 0});var p=o._limit||n.length,d=o._skip||0;n=n.slice(d,d+p)}try{n=o.project(n)}catch(v){t=v,n=undefined}return c(t,n)})},s.prototype.exec=function(){this.db.executor.push({"this":this,fn:this._exec,arguments:arguments})},n
.exports=s},{"./model":10}],6:[function(e,t,n){function r(e){var t=new Array(e),n;for(var r=0,n;r<e;r++)(r&3)==0&&(n=Math.random()*4294967296),t[r]=n>>>((r&3)<<3)&255;return t}function i(e){function u(e){return t[e>>18&63]+t[e>>12&63]+t[e>>6&63]+t[e&63]}var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"
,n=e.length%3,r="",i,s,o;for(o=0,s=e.length-n;o<s;o+=3)i=(e[o]<<16)+(e[o+1]<<8)+e[o+2],r+=u(i);switch(n){case 1:i=e[e.length-1],r+=t[i>>2],r+=t[i<<4&63],r+="==";break;case 2:i=(e[e.length-2]<<8)+e[e.length-1],r+=t[i>>10],r+=t[i>>4&63],r+=t[i<<2&63],r+="="}return r
}function s(e){return i(r(Math.ceil(Math.max(8,e*2)))).replace(/[+\/]/g,"").slice(0,e)}t.exports.uid=s},{}],7:[function(t,n,r){var i,s=t("./customUtils"),o=t("./model"),u=e.Executor=t("./executor"),a=e.Index=t("./indexes"),f=e.Persistence=t("./persistence")
,l=t("./cursor");i=e,i.prototype.loadDatabase=function(){this.executor.push({"this":this.persistence,fn:this.persistence.loadDatabase,arguments:arguments},!0)},i.prototype.getAllData=function(){return this.indexes._id.getAll()},i.prototype.resetIndexes=function(
e){var t=this;Object.keys(this.indexes).forEach(function(n){t.indexes[n].reset(e)})},i.prototype.ensureIndex=function(e,t){var n,r=t;if(!e.fieldName)return n=new Error("Cannot create an index without a fieldName"),n.missingFieldName=!0,r(n);if(this.indexes[
e.fieldName])return r();this.indexes[e.fieldName]=new a(e),e.expireAfterSeconds!==undefined&&(this.ttlIndexes[e.fieldName]=e.expireAfterSeconds);try{this.indexes[e.fieldName].insert(this.getAllData())}catch(i){return delete this.indexes[e.fieldName],r(i)}this
.persistence.persistNewState([{$$indexCreated:e}],function(e){return e?r(e):r()})},i.prototype.removeIndex=function(e,t){var n=t;delete this.indexes[e],this.persistence.persistNewState([{$$indexRemoved:e}],function(e){return e?n(e):n()})},i.prototype.addToIndexes=
function(e){var t,n,r,i=Object.keys(this.indexes);for(t=0;t<i.length;t+=1)try{this.indexes[i[t]].insert(e)}catch(s){n=t,r=s;break}if(r){for(t=0;t<n;t+=1)this.indexes[i[t]].remove(e);throw r}},i.prototype.removeFromIndexes=function(e){var t=this;Object.keys(
this.indexes).forEach(function(n){t.indexes[n].remove(e)})},i.prototype.updateIndexes=function(e,t){var n,r,i,s=Object.keys(this.indexes);for(n=0;n<s.length;n+=1)try{this.indexes[s[n]].update(e,t)}catch(o){r=n,i=o;break}if(i){for(n=0;n<r;n+=1)this.indexes[s
[n]].revertUpdate(e,t);throw i}},i.prototype.getCandidates=function(t,n,r){var i=this,s;typeof n=="function"&&(r=n,n=!1);var o,u;o=0,u=function(a,f){o=a?Infinity:o+1;switch(o){case 1:s=[],Object.keys(t).forEach(function(n){(typeof t[n]=="string"||typeof t[n
]=="number"||typeof t[n]=="boolean"||e.isDate(t[n])||t[n]===null)&&s.push(n)}),s=s.filter(function(e){return i.indexes.hasOwnProperty(e)});if(s.length>0)return u(null,i.indexes[s[0]].getMatching(t[s[0]]));s=[],Object.keys(t).forEach(function(e){t[e]&&t[e].hasOwnProperty
("$in")&&s.push(e)}),s=s.filter(function(e){return i.indexes.hasOwnProperty(e)});if(s.length>0)return u(null,i.indexes[s[0]].getMatching(t[s[0]].$in));s=[],Object.keys(t).forEach(function(e){t[e]&&(t[e].hasOwnProperty("$lt")||t[e].hasOwnProperty("$lte")||t[
e].hasOwnProperty("$gt")||t[e].hasOwnProperty("$gte"))&&s.push(e)}),s=s.filter(function(e){return i.indexes.hasOwnProperty(e)});if(s.length>0)return u(null,i.indexes[s[0]].getBetweenBounds(t[s[0]]));return u(null,i.getAllData());default:if(n)return r(null,f
);var l=[],c=[],h=Object.keys(i.ttlIndexes);f.forEach(function(t){var n=!0;h.forEach(function(r){t[r]!==undefined&&e.isDate(t[r])&&Date.now()>t[r].getTime()+i.ttlIndexes[r]*1e3&&(n=!1)}),n?c.push(t):l.push(t._id)}),e.asyncEachSeries(l,function(e,t){i._remove
({_id:e},{},function(e){return e?r(e):t()})},function(e){return r(null,c)})}},u()},i.prototype._insert=function(e,t){var n=t,r;try{r=this.prepareDocumentForInsertion(e),this._insertInCache(r)}catch(i){return n(i)}this.persistence.persistNewState(Array.isArray
(r)?r:[r],function(e){return e?n(e):n(null,o.deepCopy(r))})},i.prototype.createNewId=function(){var e=s.uid(16);return this.indexes._id.getMatching(e).length>0&&(e=this.createNewId()),e},i.prototype.prepareDocumentForInsertion=function(e){var t,n=this;if(Array
.isArray(e))t=[],e.forEach(function(e){t.push(n.prepareDocumentForInsertion(e))});else{t=o.deepCopy(e),t._id===undefined&&(t._id=this.createNewId());var r=(new Date).toISOString();t.createdAt===undefined&&(t.createdAt=r),t.updatedAt===undefined&&(t.updatedAt=
r),o.checkObject(t)}return t},i.prototype._insertInCache=function(e){Array.isArray(e)?this._insertMultipleDocsInCache(e):this.addToIndexes(e)},i.prototype._insertMultipleDocsInCache=function(e){var t,n,r;for(t=0;t<e.length;t+=1)try{this.addToIndexes(e[t])}catch(
i){r=i,n=t;break}if(r){for(t=0;t<n;t+=1)this.removeFromIndexes(e[t]);throw r}},i.prototype.insert=function(){this.executor.push({"this":this,fn:this._insert,arguments:arguments})},i.prototype.count=function(e,t){var n=new l(this,e,function(e,t,n){return e?n
(e):n(null,t.length)});if(typeof t!="function")return n;n.exec(t)},i.prototype.find=function(e,t,n){switch(arguments.length){case 1:t={};break;case 2:typeof t=="function"&&(n=t,t={})}var r=new l(this,e,function(e,t,n){var r=[],i;if(e)return n(e);for(i=0;i<t
.length;i+=1)r.push(o.deepCopy(t[i]));return n(null,r)});r.projection(t);if(typeof n!="function")return r;r.exec(n)},i.prototype.findOne=function(e,t,n){switch(arguments.length){case 1:t={};break;case 2:typeof t=="function"&&(n=t,t={})}var r=new l(this,e,function(
e,t,n){return e?n(e):t.length===1?n(null,o.deepCopy(t[0])):n(null,null)});r.projection(t).limit(1);if(typeof n!="function")return r;r.exec(n)},i.prototype._update=function(e,t,n,r){var i,s=this,u=0,a,f,c;typeof n=="function"&&(r=n,n={}),i=r,a=n.multi!==undefined?
n.multi:!1,f=n.upsert!==undefined?n.upsert:!1;var h,p;h=0,p=function(r){h=r?Infinity:h+1;switch(h){case 1:if(!f)return p();var d=new l(s,e);d.limit(1)._exec(function(n,r){if(n)return i(n);if(r.length===1)return p();var u;try{o.checkObject(t),u=t}catch(a){try{
u=o.modify(o.deepCopy(e,!0),t)}catch(n){return i(n)}}return s._insert(u,function(e,t){return e?i(e):i(null,1,t,!0)})});break;default:var v,m=[],g;s.getCandidates(e,function(r,f){if(r)return i(r);try{for(c=0;c<f.length;c+=1)o.match(f[c],e)&&(a||u===0)&&(u+=1
,g=f[c].createdAt,v=o.modify(f[c],t),v.createdAt=g,v.updatedAt=(new Date).toISOString(),m.push({oldDoc:f[c],newDoc:v}))}catch(r){return i(r)}try{s.updateIndexes(m)}catch(r){return i(r)}var l=m.map(function(e){return e.newDoc});s.persistence.persistNewState(
l,function(e){if(e)return i(e);if(!n.returnUpdatedDocs)return i(null,u);var t=[];return l.forEach(function(e){t.push(o.deepCopy(e))}),a||(t=t[0]),i(null,u,t)})})}},p()},i.prototype.update=function(){this.executor.push({"this":this,fn:this._update,arguments:
arguments})},i.prototype._remove=function(e,t,n){var r,i=this,s=0,u=[],a;typeof t=="function"&&(n=t,t={}),r=n,a=t.multi!==undefined?t.multi:!1,this.getCandidates(e,!0,function(t,n){if(t)return r(t);try{n.forEach(function(t){o.match(t,e)&&(a||s===0)&&(s+=1,u
.push({$$deleted:!0,_id:t._id}),i.removeFromIndexes(t))})}catch(t){return r(t)}i.persistence.persistNewState(u,function(e){return e?r(e):r(null,s)})})},i.prototype.remove=function(){this.executor.push({"this":this,fn:this._remove,arguments:arguments})},n.exports=
i},{"./cursor":5,"./customUtils":6,"./executor":8,"./indexes":9,"./model":10,"./persistence":11}],8:[function(t,n,r){function i(){this.buffer=[],this.ready=!1,this.queue=e.asyncQueue(function(e,t){var n=[];for(var r=0;r<e.arguments.length;r+=1)n.push(e.arguments
[r]);var i=e.arguments[e.arguments.length-1];typeof i=="function"?n[n.length-1]=function(){typeof setImmediate=="function"?setImmediate(t):setTimeout(t),i.apply(null,arguments)}:!i&&e.arguments.length!==0?n[n.length-1]=function(){t()}:n.push(function(){t()}
),e.fn.apply(e.this,n)})}i.prototype.push=function(e,t){this.ready||t?this.queue.push(e):this.buffer.push(e)},n.exports=i},{}],9:[function(t,n,r){function o(e){return e===null?"$null":typeof e=="string"?"$string"+e:typeof e=="boolean"?"$boolean"+e:typeof e=="number"?"$number"+
e:Array.isArray(e)?"$date"+e.getTime():e}function u(e){this.fieldName=e.fieldName,this.unique=e.unique||!1,this.sparse=e.sparse||!1,this.treeOptions={unique:this.unique},this.reset()}var i=t("./lib/avltree"),s=t("./model");u.prototype.reset=function(e){this
.tree=new i(this.treeOptions),e&&this.insert(e)},u.prototype.insert=function(t){var n,r=this,i,u,a,f;if(Array.isArray(t)){this.insertMultipleDocs(t);return}n=s.getDotValue(t,this.fieldName);if(n===undefined&&this.sparse)return;if(!Array.isArray(n))this.tree
.insert(n,t);else{i=e.listUnique(n).map(o);for(u=0;u<i.length;u+=1)try{this.tree.insert(i[u],t)}catch(l){f=l,a=u;break}if(f){for(u=0;u<a;u+=1)this.tree.delete(i[u],t);throw f}}},u.prototype.insertMultipleDocs=function(e){var t,n,r;for(t=0;t<e.length;t+=1)try{
this.insert(e[t])}catch(i){n=i,r=t;break}if(n){for(t=0;t<r;t+=1)this.remove(e[t]);throw n}},u.prototype.remove=function(t){var n,r=this;if(Array.isArray(t)){t.forEach(function(e){r.remove(e)});return}n=s.getDotValue(t,this.fieldName);if(n===undefined&&this.
sparse)return;Array.isArray(n)?e.listUnique(n).map(o).forEach(function(e){r.tree.delete(e,t)}):this.tree.delete(n,t)},u.prototype.update=function(e,t){if(Array.isArray(e)){this.updateMultipleDocs(e);return}this.remove(e);try{this.insert(t)}catch(n){throw this
.insert(e),n}},u.prototype.updateMultipleDocs=function(e){var t,n,r;for(t=0;t<e.length;t+=1)this.remove(e[t].oldDoc);for(t=0;t<e.length;t+=1)try{this.insert(e[t].newDoc)}catch(i){r=i,n=t;break}if(r){for(t=0;t<n;t+=1)this.remove(e[t].newDoc);for(t=0;t<e.length
;t+=1)this.insert(e[t].oldDoc);throw r}},u.prototype.revertUpdate=function(e,t){var n=[];Array.isArray(e)?(e.forEach(function(e){n.push({oldDoc:e.newDoc,newDoc:e.oldDoc})}),this.update(n)):this.update(t,e)},u.prototype.getMatching=function(e){var t=this;if(!
Array.isArray(e))return t.tree.search(e);var n={},r=[];return e.forEach(function(e){t.getMatching(e).forEach(function(e){n[e._id]=e})}),Object.keys(n).forEach(function(e){r.push(n[e])}),r},u.prototype.getBetweenBounds=function(e){return this.tree.betweenBounds
(e)},u.prototype.getAll=function(){var e=[];return this.tree.executeOnEveryNode(function(t){var n;for(n=0;n<t.data.length;n+=1)e.push(t.data[n])}),e},n.exports=u},{"./model":10,"./lib/avltree":15}],10:[function(t,n,r){function f(e,t){typeof e=="number"&&(e=
e.toString());if(!(e[0]!=="$"||e==="$$date"&&typeof t=="number"||e==="$$deleted"&&t===!0||e==="$$indexCreated"||e==="$$indexRemoved"))throw new Error("Field names cannot begin with the $ character");if(e.indexOf(".")!==-1)throw new Error("Field names cannot contain a ."
)}function l(e){Array.isArray(e)&&e.forEach(function(e){l(e)}),typeof e=="object"&&e!==null&&Object.keys(e).forEach(function(t){f(t,e[t]),l(e[t])})}function c(e){var t;return t=JSON.stringify(e,function(e,t){return f(e,t),t===undefined?undefined:t===null?null
:typeof this[e].getTime=="function"?{$$date:this[e].getTime()}:t}),t}function h(e){return JSON.parse(e,function(e,t){return e==="$$date"?(new Date(t)).toISOString():typeof t=="string"||typeof t=="number"||typeof t=="boolean"||t===null?t:t&&t.$$date?t.$$date
:t})}function p(t,n){var r;return typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t===null||e.isDate(t)?t:Array.isArray(t)?(r=[],t.forEach(function(e){r.push(p(e,n))}),r):typeof t=="object"?(r={},Object.keys(t).forEach(function(e){if(!n||e[0]!=="$"&&
e.indexOf(".")===-1)r[e]=p(t[e],n)}),r):undefined}function d(t){return typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t===null||e.isDate(t)||Array.isArray(t)}function v(e){return function(t,n,r){var o=typeof n=="string"?n.split("."):n;if(o.length===1
)s[e](t,n,r);else{if(t[o[0]]===undefined){if(e==="$unset")return;t[o[0]]={}}i[e](t[o[0]],o.slice(1),r)}}}function m(t,n){var r=Object.keys(n),s=r.map(function(e){return e[0]}),o=s.filter(function(e){return e==="$"}),u,a;if(r.indexOf("_id")!==-1&&n._id!==t._id
)throw new Error("You cannot change a document's _id");if(o.length!==0&&o.length!==s.length)throw new Error("You cannot mix modifiers and normal fields");o.length===0?(u=p(n),u._id=t._id):(a=e.listUnique(r),u=p(t),a.forEach(function(e){var t;if(!i[e])throw new 
Error("Unknown modifier "+e);if(typeof n[e]!="object")throw new Error("Modifier "+e+"'s argument must be an object");t=Object.keys(n[e]),t.forEach(function(t){i[e](u,t,n[e][t])})})),l(u);if(t._id!==u._id)throw new Error("You can't change a document's _id");
return u}function g(e,t){var n=typeof t=="string"?t.split("."):t,r,i;if(!e)return undefined;if(n.length===0)return e;if(n.length===1)return e[n[0]];if(Array.isArray(e[n[0]])){r=parseInt(n[1],10);if(typeof r=="number"&&!isNaN(r))return g(e[n[0]][r],n.slice(2
));i=new Array;for(r=0;r<e[n[0]].length;r+=1)i.push(g(e[n[0]][r],n.slice(1)));return i}return g(e[n[0]],n.slice(1))}function y(t,n){var r,i,s;if(t===null||typeof t=="string"||typeof t=="boolean"||typeof t=="number"||n===null||typeof n=="string"||typeof n=="boolean"||typeof 
n=="number")return t===n;if(e.isDate(t)||e.isDate(n))return e.isDate(t)&&e.isDate(n)&&t.getTime()===n.getTime();if((!Array.isArray(t)||!Array.isArray(n))&&(Array.isArray(t)||Array.isArray(n))||t===undefined||n===undefined)return!1;try{r=Object.keys(t),i=Object
.keys(n)}catch(o){return!1}if(r.length!==i.length)return!1;for(s=0;s<r.length;s+=1){if(i.indexOf(r[s])===-1)return!1;if(!y(t[r[s]],n[r[s]]))return!1}return!0}function b(t,n){return typeof t!="string"&&typeof t!="number"&&!e.isDate(t)&&typeof n!="string"&&typeof 
n!="number"&&!e.isDate(n)?!1:typeof t!=typeof n?!1:!0}function w(e,t){var n,r,i,s;if(d(e)||d(t))return E({needAKey:e},"needAKey",t);n=Object.keys(t);for(s=0;s<n.length;s+=1){r=n[s],i=t[r];if(r[0]==="$"){if(!u[r])throw new Error("Unknown logical operator "+r
);if(!u[r](e,i))return!1}else if(!E(e,r,i))return!1}return!0}function E(t,n,r,i){var s=g(t,n),u,f,l,c;if(Array.isArray(s)&&!i){if(Array.isArray(r))return E(t,n,r,!0);if(r!==null&&typeof r=="object"&&!e.isRegExp(r)){f=Object.keys(r);for(u=0;u<f.length;u+=1)if(
a[f[u]])return E(t,n,r,!0)}for(u=0;u<s.length;u+=1)if(E({k:s[u]},"k",r))return!0;return!1}if(r!==null&&typeof r=="object"&&!e.isRegExp(r)&&!Array.isArray(r)){f=Object.keys(r),l=f.map(function(e){return e[0]}),c=l.filter(function(e){return e==="$"});if(c.length!==0&&
c.length!==l.length)throw new Error("You cannot mix operators and normal fields");if(c.length>0){for(u=0;u<f.length;u+=1){if(!o[f[u]])throw new Error("Unknown comparison function "+f[u]);if(!o[f[u]](s,r[f[u]]))return!1}return!0}}return e.isRegExp(r)?o.$regex
(s,r):y(s,r)?!0:!1}var i={},s={},o={},u={},a={};s.$set=function(e,t,n){e[t]=n},s.$unset=function(e,t,n){delete e[t]},s.$push=function(e,t,n){e.hasOwnProperty(t)||(e[t]=[]);if(!Array.isArray(e[t]))throw new Error("Can't $push an element on non-array values")
;n!==null&&typeof n=="object"&&n.$slice&&n.$each===undefined&&(n.$each=[]);if(n!==null&&typeof n=="object"&&n.$each){if(Object.keys(n).length>=3||Object.keys(n).length===2&&n.$slice===undefined)throw new Error("Can only use $slice in cunjunction with $each when $push to array"
);if(!Array.isArray(n.$each))throw new Error("$each requires an array value");n.$each.forEach(function(n){e[t].push(n)});if(n.$slice===undefined||typeof n.$slice!="number")return;if(n.$slice===0)e[t]=[];else{var r,i,s=e[t].length;n.$slice<0?(r=Math.max(0,s+
n.$slice),i=s):n.$slice>0&&(r=0,i=Math.min(s,n.$slice)),e[t]=e[t].slice(r,i)}}else e[t].push(n)},s.$addToSet=function(t,n,r){var i=!0;t.hasOwnProperty(n)||(t[n]=[]);if(!Array.isArray(t[n]))throw new Error("Can't $addToSet an element on non-array values");if(
r!==null&&typeof r=="object"&&r.$each){if(Object.keys(r).length>1)throw new Error("Can't use another field in conjunction with $each");if(!Array.isArray(r.$each))throw new Error("$each requires an array value");r.$each.forEach(function(e){s.$addToSet(t,n,e)
})}else t[n].forEach(function(t){e.sortCompare(t,r)===0&&(i=!1)}),i&&t[n].push(r)},s.$pop=function(e,t,n){if(!Array.isArray(e[t]))throw new Error("Can't $pop an element from non-array values");if(typeof n!="number")throw new Error(n+" isn't an integer, can't use it with $pop"
);if(n===0)return;n>0?e[t]=e[t].slice(0,e[t].length-1):e[t]=e[t].slice(1)},s.$pull=function(e,t,n){var r,i;if(!Array.isArray(e[t]))throw new Error("Can't $pull an element from non-array values");r=e[t];for(i=r.length-1;i>=0;i-=1)w(r[i],n)&&r.splice(i,1)},s.
$inc=function(e,t,n){if(typeof n!="number")throw new Error(n+" must be a number");if(typeof e[t]!="number"){if(!!e.hasOwnProperty(t))throw new Error("Don't use the $inc modifier on non-number fields");e[t]=n}else e[t]+=n},s.$max=function(e,t,n){typeof e[t]=="undefined"?
e[t]=n:n>e[t]&&(e[t]=n)},s.$min=function(e,t,n){typeof e[t]=="undefined"?e[t]=n:n<e[t]&&(e[t]=n)},Object.keys(s).forEach(function(e){i[e]=v(e)}),o.$lt=function(e,t){return b(e,t)&&e<t},o.$lte=function(e,t){return b(e,t)&&e<=t},o.$gt=function(e,t){return b(e
,t)&&e>t},o.$gte=function(e,t){return b(e,t)&&e>=t},o.$ne=function(e,t){return e===undefined?!0:!y(e,t)},o.$in=function(e,t){var n;if(!Array.isArray(t))throw new Error("$in operator called with a non-array");for(n=0;n<t.length;n+=1)if(y(e,t[n]))return!0;return!1
},o.$nin=function(e,t){if(!Array.isArray(t))throw new Error("$nin operator called with a non-array");return!o.$in(e,t)},o.$regex=function(t,n){if(!e.isRegExp(n))throw new Error("$regex operator called with non regular expression");return typeof t!="string"?!1
:n.test(t)},o.$exists=function(e,t){return t||t===""?t=!0:t=!1,e===undefined?!t:t},o.$size=function(e,t){if(!Array.isArray(e))return!1;if(t%1!==0)throw new Error("$size operator called without an integer");return e.length==t},o.$elemMatch=function(e,t){if(!
Array.isArray(e))return!1;var n=e.length,r=!1;while(n--)if(w(e[n],t)){r=!0;break}return r},a.$size=!0,a.$elemMatch=!0,u.$or=function(e,t){var n;if(!Array.isArray(t))throw new Error("$or operator used without an array");for(n=0;n<t.length;n+=1)if(w(e,t[n]))return!0
;return!1},u.$and=function(e,t){var n;if(!Array.isArray(t))throw new Error("$and operator used without an array");for(n=0;n<t.length;n+=1)if(!w(e,t[n]))return!1;return!0},u.$not=function(e,t){return!w(e,t)},u.$where=function(e,t){var n;if(typeof t!="function"
)throw new Error("$where operator used without a function");n=t.call(e);if(typeof n!="boolean")throw new Error("$where function must return boolean");return n},n.exports.serialize=c,n.exports.deserialize=h,n.exports.deepCopy=p,n.exports.checkObject=l,n.exports
.isPrimitiveType=d,n.exports.modify=m,n.exports.getDotValue=g,n.exports.match=w,n.exports.areThingsEqual=y},{}],11:[function(t,n,r){function u(e){var t,n,r;this.db=e.db}var i=t("./model"),s=t("./customUtils"),o=t("./indexes");u.prototype.persistCachedDatabase=
function(t){var n=t,r="",s=this;this.db.getAllData().forEach(function(e){r+=i.serialize(e)+"\n"}),Object.keys(this.db.indexes).forEach(function(e){e!="_id"&&(r+=i.serialize({$$indexCreated:{fieldName:e,unique:s.db.indexes[e].unique,sparse:s.db.indexes[e].sparse
}})+"\n")}),e.storeSetItem(this.db.name,r,function(e){return e?n(e):n()})},u.prototype.compactDatafile=function(){this.db.executor.push({"this":this,fn:this.persistCachedDatabase,arguments:[]})},u.prototype.persistNewState=function(t,n){var r=this,s="",o=n;
t.forEach(function(e){s+=i.serialize(e)+"\n"});if(s.length===0)return o();e.storeGetItem(r.db.name,function(t,n){e.storeSetItem(r.db.name,(n||"")+s,o)})},u.prototype.treatRawData=function(t){var n=t.split("\n"),r={},s=[],o,u={},a=-1;for(o=0;o<n.length;o+=1)
{var f;try{f=i.deserialize(n[o]),f._id?f.$$deleted===!0?delete r[f._id]:r[f._id]=f:f.$$indexCreated&&f.$$indexCreated.fieldName!=undefined?u[f.$$indexCreated.fieldName]=f.$$indexCreated:typeof f.$$indexRemoved=="string"&&delete u[f.$$indexRemoved]}catch(l){
a+=1,e.assert(!a,l)}}return Object.keys(r).forEach(function(e){s.push(r[e])}),{data:s,indexes:u}},u.prototype.loadDatabase=function(t){var n=t,r=this;r.db.resetIndexes();var i,s,u;s=0,u=function(t){s=t?Infinity:s+1;switch(s){case 1:e.storeGetItem(r.db.name,
function(e,t){try{var n=r.treatRawData(t||"")}catch(i){return u(i)}Object.keys(n.indexes).forEach(function(e){r.db.indexes[e]=new o(n.indexes[e])});try{r.db.resetIndexes(n.data)}catch(i){return r.db.resetIndexes(),u(i)}r.db.persistence.persistCachedDatabase
(u)});break;default:if(t)return n(t);r.db.executor.ready=!0;while(r.db.executor.buffer.length)r.db.executor.queue.push(r.db.executor.buffer.shift());return n()}},u()},n.exports=u},{"./customUtils":6,"./indexes":9,"./model":10}],15:[function(t,n,r){function s
(e){this.tree=new o(e)}function o(e){e=e||{},this.left=null,this.right=null,this.parent=e.parent!==undefined?e.parent:null,e.hasOwnProperty("key")&&(this.key=e.key),this.data=e.hasOwnProperty("value")?[e.value]:[],this.unique=e.unique||!1}var i=t("./bst");e
.inherits(o,i),s._AVLTree=o,o.prototype.checkHeightCorrect=function(){var e,t;if(!this.hasOwnProperty("key"))return;if(this.left&&this.left.height===undefined)throw new Error("Undefined height for node "+this.left.key);if(this.right&&this.right.height===undefined
)throw new Error("Undefined height for node "+this.right.key);if(this.height===undefined)throw new Error("Undefined height for node "+this.key);e=this.left?this.left.height:0,t=this.right?this.right.height:0;if(this.height!==1+Math.max(e,t))throw new Error("Height constraint failed for node "+
this.key);this.left&&this.left.checkHeightCorrect(),this.right&&this.right.checkHeightCorrect()},o.prototype.balanceFactor=function(){var e=this.left?this.left.height:0,t=this.right?this.right.height:0;return e-t},o.prototype.checkBalanceFactors=function(){
if(Math.abs(this.balanceFactor())>1)throw new Error("Tree is unbalanced at node "+this.key);this.left&&this.left.checkBalanceFactors(),this.right&&this.right.checkBalanceFactors()},o.prototype.checkIsAVLT=function(){o.super_.prototype.checkIsBST.call(this),
this.checkHeightCorrect(),this.checkBalanceFactors()},s.prototype.checkIsAVLT=function(){this.tree.checkIsAVLT()},o.prototype.rightRotation=function(){var e=this,t=this.left,n,r,i,s;return t?(n=t.right,e.parent?(t.parent=e.parent,e.parent.left===e?e.parent.
left=t:e.parent.right=t):t.parent=null,t.right=e,e.parent=t,e.left=n,n&&(n.parent=e),r=t.left?t.left.height:0,i=n?n.height:0,s=e.right?e.right.height:0,e.height=Math.max(i,s)+1,t.height=Math.max(r,e.height)+1,t):this},o.prototype.leftRotation=function(){var e=
this,t=this.right,n,r,i,s;return t?(n=t.left,e.parent?(t.parent=e.parent,e.parent.left===e?e.parent.left=t:e.parent.right=t):t.parent=null,t.left=e,e.parent=t,e.right=n,n&&(n.parent=e),r=e.left?e.left.height:0,i=n?n.height:0,s=t.right?t.right.height:0,e.height=
Math.max(r,i)+1,t.height=Math.max(s,e.height)+1,t):this},o.prototype.rightTooSmall=function(){return this.balanceFactor()<=1?this:(this.left.balanceFactor()<0&&this.left.leftRotation(),this.rightRotation())},o.prototype.leftTooSmall=function(){return this.balanceFactor
()>=-1?this:(this.right.balanceFactor()>0&&this.right.rightRotation(),this.leftRotation())},o.prototype.rebalanceAlongPath=function(e){var t=this,n,r;if(!this.hasOwnProperty("key"))return delete this.height,this;for(r=e.length-1;r>=0;r-=1)e[r].height=1+Math
.max(e[r].left?e[r].left.height:0,e[r].right?e[r].right.height:0),e[r].balanceFactor()>1&&(n=e[r].rightTooSmall(),r===0&&(t=n)),e[r].balanceFactor()<-1&&(n=e[r].leftTooSmall(),r===0&&(t=n));return t},o.prototype.insert=function(t,n){var r=[],i=this;if(!this
.hasOwnProperty("key"))return this.key=t,this.data.push(n),this.height=1,this;for(;;){if(e.sortCompare(i.key,t)===0){if(i.unique){var s=new Error("Can't insert key "+t+", it violates the unique constraint");throw s.key=t,s.errorType="uniqueViolated",s}return i
.data.push(n),this}r.push(i);if(e.sortCompare(t,i.key)<0){if(!i.left){r.push(i.createLeftChild({key:t,value:n}));break}i=i.left}else{if(!i.right){r.push(i.createRightChild({key:t,value:n}));break}i=i.right}}return this.rebalanceAlongPath(r)},s.prototype.insert=
function(e,t){var n=this.tree.insert(e,t);n&&(this.tree=n)},o.prototype.delete=function(t,n){var r=[],i,s=this,o=this,u=[];if(!this.hasOwnProperty("key"))return this;for(;;){if(e.sortCompare(t,o.key)===0)break;u.push(o);if(e.sortCompare(t,o.key)<0){if(!o.left
)return this;o=o.left}else{if(!o.right)return this;o=o.right}}if(o.data.length>1&&n)return o.data.forEach(function(e){e!==n&&r.push(e)}),o.data=r,this;if(!o.left&&!o.right)return o===this?(delete o.key,o.data=[],delete o.height,this):(o.parent.left===o?o.parent
.left=null:o.parent.right=null,this.rebalanceAlongPath(u));if(!o.left||!o.right)return i=o.left?o.left:o.right,o===this?(i.parent=null,i):(o.parent.left===o?(o.parent.left=i,i.parent=o.parent):(o.parent.right=i,i.parent=o.parent),this.rebalanceAlongPath(u))
;u.push(o),i=o.left;if(!i.right)return o.key=i.key,o.data=i.data,o.left=i.left,i.left&&(i.left.parent=o),this.rebalanceAlongPath(u);for(;;){if(!i.right)break;u.push(i),i=i.right}return o.key=i.key,o.data=i.data,i.parent.right=i.left,i.left&&(i.left.parent=i
.parent),this.rebalanceAlongPath(u)},s.prototype.delete=function(e,t){var n=this.tree.delete(e,t);n&&(this.tree=n)},["getNumberOfKeys","search","betweenBounds","prettyPrint","executeOnEveryNode"].forEach(function(e){s.prototype[e]=function(){return this.tree
[e].apply(this.tree,arguments)}}),n.exports=s},{"./bst":16}],16:[function(t,n,r){function i(e){e=e||{},this.left=null,this.right=null,this.parent=e.parent!==undefined?e.parent:null,e.hasOwnProperty("key")&&(this.key=e.key),this.data=e.hasOwnProperty("value"
)?[e.value]:[],this.unique=e.unique||!1}function s(e,t){var n;for(n=0;n<t.length;n+=1)e.push(t[n])}i.prototype.getMaxKeyDescendant=function(){return this.right?this.right.getMaxKeyDescendant():this},i.prototype.getMaxKey=function(){return this.getMaxKeyDescendant
().key},i.prototype.getMinKeyDescendant=function(){return this.left?this.left.getMinKeyDescendant():this},i.prototype.getMinKey=function(){return this.getMinKeyDescendant().key},i.prototype.checkAllNodesFullfillCondition=function(e){if(!this.hasOwnProperty("key"
))return;e(this.key,this.data),this.left&&this.left.checkAllNodesFullfillCondition(e),this.right&&this.right.checkAllNodesFullfillCondition(e)},i.prototype.checkNodeOrdering=function(){var t=this;if(!this.hasOwnProperty("key"))return;this.left&&(this.left.checkAllNodesFullfillCondition
(function(n){if(e.sortCompare(n,t.key)>=0)throw new Error("Tree with root "+t.key+" is not a binary search tree")}),this.left.checkNodeOrdering()),this.right&&(this.right.checkAllNodesFullfillCondition(function(n){if(e.sortCompare(n,t.key)<=0)throw new Error
("Tree with root "+t.key+" is not a binary search tree")}),this.right.checkNodeOrdering())},i.prototype.checkInternalPointers=function(){if(this.left){if(this.left.parent!==this)throw new Error("Parent pointer broken for key "+this.key);this.left.checkInternalPointers
()}if(this.right){if(this.right.parent!==this)throw new Error("Parent pointer broken for key "+this.key);this.right.checkInternalPointers()}},i.prototype.checkIsBST=function(){this.checkNodeOrdering(),this.checkInternalPointers();if(this.parent)throw new Error
("The root shouldn't have a parent")},i.prototype.getNumberOfKeys=function(){var e;return this.hasOwnProperty("key")?(e=1,this.left&&(e+=this.left.getNumberOfKeys()),this.right&&(e+=this.right.getNumberOfKeys()),e):0},i.prototype.createSimilar=function(e){return e=
e||{},e.unique=this.unique,new this.constructor(e)},i.prototype.createLeftChild=function(e){var t=this.createSimilar(e);return t.parent=this,this.left=t,t},i.prototype.createRightChild=function(e){var t=this.createSimilar(e);return t.parent=this,this.right=
t,t},i.prototype.insert=function(t,n){if(!this.hasOwnProperty("key")){this.key=t,this.data.push(n);return}if(e.sortCompare(this.key,t)===0){if(this.unique){var r=new Error("Can't insert key "+t+", it violates the unique constraint");throw r.key=t,r.errorType="uniqueViolated"
,r}this.data.push(n);return}e.sortCompare(t,this.key)<0?this.left?this.left.insert(t,n):this.createLeftChild({key:t,value:n}):this.right?this.right.insert(t,n):this.createRightChild({key:t,value:n})},i.prototype.search=function(t){return this.hasOwnProperty
("key")?e.sortCompare(this.key,t)===0?this.data:e.sortCompare(t,this.key)<0?this.left?this.left.search(t):[]:this.right?this.right.search(t):[]:[]},i.prototype.getLowerBoundMatcher=function(t){var n=this;return!t.hasOwnProperty("$gt")&&!t.hasOwnProperty("$gte"
)?function(){return!0}:t.hasOwnProperty("$gt")&&t.hasOwnProperty("$gte")?e.sortCompare(t.$gte,t.$gt)===0?function(n){return e.sortCompare(n,t.$gt)>0}:e.sortCompare(t.$gte,t.$gt)>0?function(n){return e.sortCompare(n,t.$gte)>=0}:function(n){return e.sortCompare
(n,t.$gt)>0}:t.hasOwnProperty("$gt")?function(n){return e.sortCompare(n,t.$gt)>0}:function(n){return e.sortCompare(n,t.$gte)>=0}},i.prototype.getUpperBoundMatcher=function(t){var n=this;return!t.hasOwnProperty("$lt")&&!t.hasOwnProperty("$lte")?function(){return!0
}:t.hasOwnProperty("$lt")&&t.hasOwnProperty("$lte")?e.sortCompare(t.$lte,t.$lt)===0?function(n){return e.sortCompare(n,t.$lt)<0}:e.sortCompare(t.$lte,t.$lt)<0?function(n){return e.sortCompare(n,t.$lte)<=0}:function(n){return e.sortCompare(n,t.$lt)<0}:t.hasOwnProperty
("$lt")?function(n){return e.sortCompare(n,t.$lt)<0}:function(n){return e.sortCompare(n,t.$lte)<=0}},i.prototype.betweenBounds=function(e,t,n){var r=[];return this.hasOwnProperty("key")?(t=t||this.getLowerBoundMatcher(e),n=n||this.getUpperBoundMatcher(e),t(
this.key)&&this.left&&s(r,this.left.betweenBounds(e,t,n)),t(this.key)&&n(this.key)&&s(r,this.data),n(this.key)&&this.right&&s(r,this.right.betweenBounds(e,t,n)),r):[]},i.prototype.deleteIfLeaf=function(){return this.left||this.right?!1:this.parent?(this.parent
.left===this?this.parent.left=null:this.parent.right=null,!0):(delete this.key,this.data=[],!0)},i.prototype.deleteIfOnlyOneChild=function(){var e;return this.left&&!this.right&&(e=this.left),!this.left&&this.right&&(e=this.right),e?this.parent?(this.parent
.left===this?(this.parent.left=e,e.parent=this.parent):(this.parent.right=e,e.parent=this.parent),!0):(this.key=e.key,this.data=e.data,this.left=null,e.left&&(this.left=e.left,e.left.parent=this),this.right=null,e.right&&(this.right=e.right,e.right.parent=this
),!0):!1},i.prototype.delete=function(t,n){var r=[],i,s=this;if(!this.hasOwnProperty("key"))return;if(e.sortCompare(t,this.key)<0){this.left&&this.left.delete(t,n);return}if(e.sortCompare(t,this.key)>0){this.right&&this.right.delete(t,n);return}if(!e.sortCompare
(t,this.key)===0)return;if(this.data.length>1&&n!==undefined){this.data.forEach(function(e){e!==n&&r.push(e)}),s.data=r;return}if(this.deleteIfLeaf())return;if(this.deleteIfOnlyOneChild())return;Math.random()>=.5?(i=this.left.getMaxKeyDescendant(),this.key=
i.key,this.data=i.data,this===i.parent?(this.left=i.left,i.left&&(i.left.parent=i.parent)):(i.parent.right=i.left,i.left&&(i.left.parent=i.parent))):(i=this.right.getMinKeyDescendant(),this.key=i.key,this.data=i.data,this===i.parent?(this.right=i.right,i.right&&
(i.right.parent=i.parent)):(i.parent.left=i.right,i.right&&(i.right.parent=i.parent)))},i.prototype.executeOnEveryNode=function(e){this.left&&this.left.executeOnEveryNode(e),e(this),this.right&&this.right.executeOnEveryNode(e)},i.prototype.prettyPrint=function(
e,t){t=t||"",console.log(t+"* "+this.key),e&&console.log(t+"* "+this.data);if(!this.left&&!this.right)return;this.left?this.left.prettyPrint(e,t+"  "):console.log(t+"  *"),this.right?this.right.prettyPrint(e,t+"  "):console.log(t+"  *")},n.exports=i},{}]},{
},[7])(7)}),function(){e.storeInit(),Object.keys(e).forEach(function(t){e[t.replace(/.*\//,"")]=e[t]})}();switch(e.modeJs){case"browser":e.global.Nedb=e.global.utility2_nedb=e,e.NODE_ENV="undefined";break;case"node":e.child_process=require("child_process"),
e.fs=require("fs"),e.os=require("os"),module.exports=module["./lib.nedb.js"]=e,e.__dirname=__dirname,e.NODE_ENV=process.env.NODE_ENV}})()